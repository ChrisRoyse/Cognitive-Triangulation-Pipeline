# Primary Project Planning Document-- Sprint 3 (Resilient & Hierarchical)

## **Sprint 3-- The Memory-- `GraphBuilder` & Validation**

### **Phase 1-- Specification**

*   **Task 3.1.1-- Define `GraphBuilder` Agent Specifications:**
    *   **AI Verifiable End Result:** The specification document [`docs/specifications/GraphBuilder_agent_specs.md`](docs/specifications/GraphBuilder_agent_specs.md) is updated to detail its responsibility for consuming both the `FileAnalysisReport` objects (for POI details) and the final `ProjectAnalysisSummary.json` (for relationships), ensuring all data is persisted idempotently.

### **Phase 2-- Pseudocode**

*   **Task 3.2.1-- Write `GraphBuilder` Pseudocode:**
    *   **AI Verifiable End Result:** The pseudocode in [`docs/specifications/GraphBuilder_agent_specs.md`](docs/specifications/GraphBuilder_agent_specs.md) is updated to show the logic for loading POIs into a lookup map, loading the relationships from the summary, and then persisting nodes and relationships in separate, batched transactions.

### **Phase 3-- Architecture**

*   **Task 3.3.1-- Design Ground-Truth Validation Framework:**
    *   **AI Verifiable End Result:** A markdown file [`docs/architecture/validation_framework.md`](docs/architecture/validation_framework.md) is created, describing the process for creating and using a ground-truth dataset to continuously evaluate the pipeline's accuracy and performance against the new hierarchical output.

### **Phase 4-- Refinement (Implementation)**

*   **Task 3.4.1-- Implement `GraphBuilder` Agent:**
    *   **Class-- `GraphBuilder`:**
        *   **Function-- `constructor(config)`:**
            *   **AI Verifiable End Result:** The `GraphBuilder` class constructor is implemented in [`src/agents/GraphBuilder.js`](src/agents/GraphBuilder.js) and successfully connects to the Neo4j database, passing a unit test.
        *   **Function-- `_loadAllPois()`:**
            *   **AI Verifiable End Result:** The `_loadAllPois` method correctly reads all `FileAnalysisReport` files and populates a Map with every POI, keyed by its unique ID. A unit test verifies the map is created correctly from sample report files.
        *   **Function-- `_persistNodes(poiMap)`:**
            *   **AI Verifiable End Result:** The `_persistNodes` method uses batched, idempotent Cypher queries to persist all POIs from the map into Neo4j. A unit test verifies that running the method twice does not create duplicate nodes.
        *   **Function-- `_persistRelationships(relationships)`:**
            *   **AI Verifiable End Result:** The `_persistRelationships` method uses batched, idempotent Cypher queries to persist all relationships. A unit test verifies that running the method twice does not create duplicate relationships.
        *   **Function-- `run()`:**
            *   **AI Verifiable End Result:** The `run` method orchestrates the loading of POIs and relationships, and then calls the persistence methods. An integration test verifies that a full run on sample `EntityScout` and `RelationshipResolver` outputs results in the correct, complete graph in Neo4j.

*   **Task 3.4.2-- Implement Validation Framework:**
    *   **AI Verifiable End Result:** A suite of tests is created in [`tests/validation/`](tests/validation/) that compares the graph generated by the pipeline against a known ground-truth graph, outputting an accuracy and completeness score.

### **Phase 5-- Completion**

*   **Task 3.5.1-- Create Final Project Report:**
    *   **AI Verifiable End Result:** A markdown file [`docs/reports/final_project_report.md`](docs/reports/final_project_report.md) is created, summarizing the project's outcomes, performance metrics from the validation framework, and recommendations for future work.