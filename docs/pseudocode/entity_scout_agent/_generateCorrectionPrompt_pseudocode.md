# Pseudocode for `_generateCorrectionPrompt` Method

## **Function--** `_generateCorrectionPrompt`

**Purpose--** This method constructs a specific prompt to guide the Language Model (LLM) in correcting a previously generated output that failed validation. It provides all the necessary context for the LLM to understand the mistake and produce a valid response.

---

### **Signature**

```plaintext
FUNCTION _generateCorrectionPrompt(fileContent, invalidOutput, errorMessage)
```

### **Inputs**

-   `fileContent` (string)-- The full string content of the source code file that was initially analyzed.
-   `invalidOutput` (string)-- The malformed JSON or text string that the LLM produced in its previous attempt.
-   `errorMessage` (string)-- The specific error message generated by the validation logic, explaining why the `invalidOutput` was rejected.

### **Output**

-   (string)-- A detailed, formatted prompt string to be sent to the LLM for the correction attempt.

---

### **Core Logic**

1.  **BEGIN**
2.
3.  -- TEST ANCHOR-- Test that the function correctly assembles a prompt with all required contextual elements.
4.  -- `TEST_HAPPY_PATH`-- Ensure the generated prompt includes the introductory text, the error message, the invalid output, and the original file content.
5.
6.  -- Initialize a prompt template or builder. This structure will guide the LLM's correction.
7.  `prompt = """
    Your previous attempt to analyze the source code and extract entities resulted in an error.
    You must correct your last output. Please pay close attention to the error message and the required format.

    **Error Message--**
    {errorMessage}

    **Your Invalid Output--**
    ```json
    {invalidOutput}
    ```

    Please analyze the following source code again and provide a new, valid JSON output that corrects the error.
    Ensure your response strictly adheres to the required JSON schema and correctly represents the entities and relationships in the code.

    **Original Source Code--**
    ```
    {fileContent}
    ```

    Corrected JSON Output--
    """`
8.
9.  -- Substitute the placeholders in the template with the actual values from the input parameters.
10. `formattedPrompt = substitute(prompt, {
        "errorMessage"-- errorMessage,
        "invalidOutput"-- invalidOutput,
        "fileContent"-- fileContent
    })`
11.
12. -- TEST ANCHOR-- Test how the function handles cases where some input might be empty, though this is unlikely in practice.
13. -- `TEST_EDGE_CASE_EMPTY_INPUT`-- Verify that if `errorMessage` or `invalidOutput` is an empty string, the prompt is still generated without causing an error, and the structure remains coherent.
14.
15. -- Return the fully constructed prompt.
16. **RETURN** `formattedPrompt`
17.
18. **END**